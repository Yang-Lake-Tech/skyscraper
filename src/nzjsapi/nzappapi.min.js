!function(e){"use strict";function r(e){function r(e){for(var r=new Uint8Array(e),n=0,o=0;4>o;o++)n=(n<<8)+r[o];return n}function n(e,r,n){for(var o=new Uint8Array(r),t=n+3;t>=n;t--)o[t]=255&e,e>>=8}function o(r){if(c){var t=r.buffer,i=r.msgId,a=new ArrayBuffer(8);n(t.byteLength+4,a,0),n(i,a,4);var p=new e(8+t.byteLength);return p.append(a),p.append(t),s.send(p.buffer),!0}r.retry>0?(r.retry--,setTimeout(o,50,r)):console.log("Cannot send App Message - no connection")}function t(e){s=new WebSocket(e),s.binaryType="arraybuffer",s.onopen=function(){console.log("Connected to "+e),c=!0},s.onclose=function(){console.log("Disconnected from "+e),s=void 0,c=!1,setTimeout(function(){t(e)},1e3)},s.onerror=function(){console.log("Error on connection to "+e),c=!1,setTimeout(function(){t(e)},1e3)},s.onmessage=function(e){try{console.log("onmessage"),i(s,e.data)}catch(r){console.log("error")}}}function i(e,n){var o=(r(n.slice(0,4)),r(n.slice(4,8)));switch(o){case l:var t=p.AppLaunchResp.decode(n.slice(8));f.AppLaunchResp&&f.AppLaunchResp(t.AppId);break;case g:var t=p.AppLaunchFailed.decode(n.slice(8));f.AppLaunchFailed&&f.AppLaunchFailed(t.Url);break;case v:var t=p.AppClose.decode(n.slice(8));f.AppVisibilityChanged&&f.AppVisibilityChanged(t.AppId);break;case b:var t=p.AppClose.decode(n.slice(8));f.AppClose&&f.AppClose(t.AppId);break;case P:var t=p.AppLaunchResp.decode(n.slice(8));f.AppRcvRawMessage&&f.AppRcvRawMessage(t.Source,t.AppOid,t.Parm,t.Data);break;default:console.log("Unknown message recevied: "+o)}}var a={},p=void 0,f=void 0,s=void 0,c=!1,u=!1,d=4352,A=d+1,l=d+2,g=d+3,y=d+4,w=d+5,v=d+6,b=d+7,I=d+9,h=d+10,m=d+11,B=d+13,P=d+14;return a.ByteBuffer=e,e.writeUInt32BE&&(e.writeUInt32BE=e.writeUInt32),a.Initialize=function(e,r){f=r,navigator.appApiPort?(p=dcodeIO.ProtoBuf.loadProtoFile(e).build("nzappapi"),p?(t(navigator.appApiIpAddress?"ws://"+navigator.appApiIpAddress+":"+navigator.appApiPort:"ws://localhost:"+navigator.appApiPort),u=!0):console.log("Failed to initialized Protocol buffers for nzappapi")):console.log("Cannot connect: navigator.appApiPort not defined")},a.AppLaunch=function(e,r,n,t,i,a,f,s,c,d,l){if(u){var g=new p.AppLaunch(e,r,n,t,i,a,f,s,c,d,l);return o({buffer:g.toArrayBuffer(),msgId:A,retry:5})}throw"API not intialized"},a.AppUpdate=function(e,r,n,t,i,a,f,s){if(u){var c=new p.AppLaunch(e,r,n,t,i,a,f,s);return o({buffer:c.toArrayBuffer(),msgId:y,retry:5})}throw"API not intialized"},a.AppActivate=function(e){if(u){var r=new p.AppActivate(e);return o({buffer:r.toArrayBuffer(),msgId:w,retry:5})}throw"API not intialized"},a.AppClose=function(e){if(u){var r=new p.AppClose(e);return o({buffer:r.toArrayBuffer(),msgId:b,retry:5})}throw"API not intialized"},a.AppVisible=function(){if(u){var e=new p.AppVisible;return o({buffer:e.toArrayBuffer(),msgId:I,retry:5})}throw"API not intialized"},a.AppShutdown=function(){if(u){var e=new p.AppShutdown;return o({buffer:e.toArrayBuffer(),msgId:h,retry:5})}throw"API not intialized"},a.AppRegisterOid=function(e){if(u){var r=new p.AppRegisterOid(e);return o({buffer:r.toArrayBuffer(),msgId:m,retry:5})}throw"API not intialized"},a.AppReleaseOid=function(e){if(u){var r=new p.AppReleaseOid(e);return o({buffer:r.toArrayBuffer(),msgId:AppReleaseOidMsgId,retry:5})}throw"API not intialized"},a.AppSendRawMessage=function(e,r,n,t){if(u){var i=new p.AppSendRawMessage(r);return o({buffer:i.toArrayBuffer(),msgId:B,retry:5})}throw"API not intialized"},a}"function"==typeof require&&"object"==typeof module&&module&&"object"==typeof exports&&exports?module.exports=r(require("bytebuffer")):(e.nz=e.nz||{}).nzappapi=r(e.dcodeIO.ByteBuffer)}(this);